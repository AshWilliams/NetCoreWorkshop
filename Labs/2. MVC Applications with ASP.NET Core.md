# Introducción al Routing & MVC

## MVC 101

### Crear una nueva ASP.NET Core Web Application

1. Abrir Visual Studio 2019
1. Crear una nueva ASP.NET Core application:
  1. File -> New -> Project -> ASP.NET Core Web Application (C#)
  2. Despues de nombrar el proyecto, seleccionen la versión de .NET Core y ASP.NET Core 2.2 en los dropdowns
  3. Seleccionen `Web Application (Model-View-Controller)` y cambien el método de autenticación a `Individual User Accounts`.

### Scaffolding-Generar un controlador completo a partir de un nuevo modelo

1. Click derecho en el directorio `Models` y seleccionar `Add`, y luego seleccionar `Class`. Nombren la nueva clase como `Persona.cs` con los siguientes atributos:

   ```c#
    public class Persona
    {
        public int ID { get; set; }
        public string Nombre { get; set; }
        public int Edad { get; set; }
    }
   ```

2. Click derecho en el directorio `Controllers` y seleccionen Add -> Controller -> MVC Controller with views, Using Entity Framework.
3. Seleccionar `Persona` as the **Model Class**.
4. Crear un nuevo **Data context class** dandole click al botón `+`.
5. Click **Add** para que genere el control y las vistas de forma automática en base al modelo Persona.
6. Revisar el archivo `appsettings.json` en `ConnectionStrings`, tomen nota del nombre de la base de datos.
7. Desde el `SQL Server Object Explorer`, en `(localdb)`, luego en `Databases`, click derecho a la opción `Add New Database` y le dan el mismo nombre que tomaron nota en el paso anterior.

### Correr Migraciones de EF para actualizar la base de datos con el nuevo modelo Person 

1. Mostrar la ventana del **Package Manager Console** seleccionando View -> Other Windows -> Package Manager Console
2. Crear una nueva migración para el modelo Person class tipeando en la consola `Add-Migration "Persona class"`
3. Actualice la base de datos utilizando esta migración escribiendo `Update-Database`
4. Ejecute la aplicación y navegue a `/Persona` desde la raíz de su aplicación (e.g. `http://localhost:61496/Persona`)
5. Intenta crear una persona con una edad no válida (e.g. "morada")  para observar que la validación de formularios funciona.
5. Cree una persona válida ingresando un nombre y una edad entera.

> **Note:** Una vez termines la actividad el código completo lo subiré a [/Labs/Code/Lab2A](/Labs/Code/Lab2A).

### Extra
1. Añadir un [Validation Attribute](https://docs.microsoft.com/en-us/aspnet/core/mvc/models/validation#validation-attributes) al modelo `Person` para que la edad quede en un rango entre 1 y 120. *cuando hagan esto, recuerden añadir y correr una nueva migración como en el paso anterior.*
1. Usando [Attribute Routing](https://docs.microsoft.com/en-us/aspnet/core/mvc/controllers/routing#attribute-routing), una ruta adicional, que le permita navegar a la accción `Index` del controlador `PeopleController` usando `http://localhost:[port]/Everyone`.

### Scaffolding-Generar un controlador completo a partir de un nuevo modelo

1. Click derecho en el directorio `Models` y seleccionar `Add`, y luego seleccionar `Class`. Nombren la nueva clase como `Producto.cs` con los siguientes atributos:

   ```c#
    public class Producto
    {
        public int ID { get; set; }
        public string Nombre { get; set; }
        public string Descripcion { get; set; }
        public int Stock { get; set; }
    }
   ```

2. Click derecho en el directorio `Controllers` y seleccionen Add -> Controller -> MVC Controller with views, Using Entity Framework.
3. Seleccionar `Producto` as the **Model Class**.
4. Crear un nuevo **Data context class** dandole click al botón `+`.
5. Click **Add** to scaffold the controller and views for the Producto model.
6. Revisar el archivo `appsettings.json` en `ConnectionStrings`, tomen nota del nombre de la base de datos.
7. Desde el `SQL Server Object Explorer`, en `(localdb)`, luego en `Databases`, click derecho a la opción `Add New Database` y le dan el mismo nombre que tomaron nota en el paso anterior.

### Correr Migraciones de EF para actualizar la base de datos con el nuevo modelo Person 

1. Mostrar la ventana del **Package Manager Console** seleccionando View -> Other Windows -> Package Manager Console
2. Crear una nueva migración para el modelo Person class tipeando en la consola `Add-Migration "Producto class"`
3. Actualice la base de datos utilizando esta migración escribiendo `Update-Database`
4. Ejecute la aplicación y navegue a `/Producto` desde la raíz de su aplicación (e.g. `http://localhost:61496/Producto`)
5. Intenta crear un producto con un stock no válido (e.g. "morada") para observar que la validación de formularios funciona.
5. Cree un producto válido.

> **Note:** Una vez termines la actividad el código completo lo subiré a [/Labs/Code/Lab2A](/Labs/Code/Lab2A).

## Using Routing in an Empty Web Application

### Create a new Empty ASP.NET Core application

1. Open Visual Studio 2019
1. Create a new ASP.NET Core application:
  1. File -> New -> Project -> ASP.NET Core Web Application (C#)
  2. After naming the project, set the dropdowns to .NET Core and ASP.NET Core 2.2 and select the Empty template.



